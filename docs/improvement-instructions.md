# コーディングエージェントへの改善指示

> 競合分析（`docs/competitive-analysis.md`）に基づく、優先度付き改善タスクリスト
> 作成日: 2026-02-07

---

## 優先度 P0: 競合の失敗から学ぶ必須対策

### 1. Bot/スパム対策の強化
**根拠**: Xbox LFGはBot大量流入で事実上崩壊した。公開Webアプリでは初日から必須。

```
実装タスク:
- [x] 匿名ログインにCAPTCHA（hCaptcha/Turnstile）を追加
  - 理由: ニックネームだけのログインはBot作成が容易すぎる
  - GameWithも新規24時間制限で対策している
  - ✅ Cloudflare Turnstile実装済み (app/services/turnstile.py)
- [x] 同一IPからの短時間大量アカウント作成を検知・ブロック
  - 現状: ログイン30/hの制限のみ → IPあたり10/h程度に引き下げ検討
  - ✅ ログインレート制限 10/hour に設定済み
- [x] 募集投稿のフィンガープリント重複検出
  - 同一内容の募集を短期間に繰り返すパターンを検知
  - ✅ 同一IP+ゲーム+リージョンで5分以内の重複検出実装済み
```

### 2. リアルタイム通知（WebSocket/SSE）
**根拠**: 全競合（Lobi「シャウト」、LFG Hub「スマート通知」、Discord Bot通知）が通知機能を持つ。ポーリングでは「マッチ成立の即時性」で劣る。

```
実装タスク:
- [x] マッチ成立時のWebSocket/SSE通知
  - 現状: 募集リスト5秒ポーリング、メッセージ3秒ポーリング
  - 改善: マッチ成立→即座にルーム画面へ遷移
  - ✅ WebSocketチケット認証 + ConnectionManager + match_created イベント実装済み
- [x] 新メッセージのリアルタイム配信
  - ポーリング→WebSocket化でサーバー負荷も軽減
  - ✅ new_message/room_closed/close_requested イベント実装済み
- [ ] ブラウザPush通知（Service Worker）
  - タブを離れていてもマッチ成立を通知
```

---

## 優先度 P1: 競合の弱点を突く差別化強化

### 3. ゲームカタログの拡充
**根拠**: GamerLinkは600+ゲーム対応。現状10ゲーム+Otherでは対応範囲が狭すぎる。

```
実装タスク:
- [x] ゲームデータをDB管理に移行（現状: フロントのハードコード）
  - games テーブル: id, name, name_ja, icon_url, category, platform_tags
  - ✅ games テーブル作成、Gameモデル、/api/games エンドポイント実装済み
- [x] ゲーム検索・フィルター機能
  - カテゴリ（FPS/MOBA/RPG/カードゲーム等）
  - プラットフォーム（PC/PS/Xbox/Switch/Mobile）
  - ✅ category, platform, q パラメータによるフィルタリング実装済み
- [ ] ユーザーが「Other」で入力したゲーム名を集計→人気順に昇格提案
- [x] 初期データとして最低50タイトルを登録
  - ✅ 55タイトル登録済み（FPS/MOBA/RPG/格闘/カード/サバイバル等）
```

### 4. モバイル体験の改善（PWA化）
**根拠**: GamerLink/GameTreeはモバイルネイティブ。スマホゲーマーが主要ターゲット。Lobi元ユーザーもスマホ主体。

```
実装タスク:
- [x] PWA対応（manifest.json + Service Worker）
  - ホーム画面追加でアプリライクな体験
  - ✅ vite-plugin-pwa によるmanifest + Service Worker自動生成、ゲームAPIキャッシュ
- [ ] モバイルファーストUIの見直し
  - 募集リスト: カード型レイアウトのタップしやすさ確認
  - チャット: モバイルキーボード表示時のレイアウト調整
- [x] オフライン時の最低限UX（接続復帰時の自動再接続）
  - ✅ WebSocket exponential backoff再接続 + PWA precache実装済み
```

### 5. マッチ精度の改善
**根拠**: GameTreeはML性格マッチ、GamerLinkはロール指定マッチを提供。単純な先着マッチだけでは差別化不十分。

```
実装タスク:
- [x] 「希望プレイスタイル」フィールド追加（カジュアル/ガチ/初心者歓迎）
  - GameTree的なアプローチの簡易版
  - ✅ PlayStyle enum (casual/competitive/beginner_welcome) + フロント選択UI実装済み
- [x] 「マイク有無」フィールド追加
  - GamerLink/Xbox LFGで共通の重要フィルター（VCなしルールだが相手のマイク環境は参考情報になる）
  - ✅ has_microphone boolean + フロントチェックボックス + 募集一覧MICバッジ実装済み
- [x] マッチング待機時間の表示
  - GameWithの2分タイムアウトは不満が多い→待機時間を可視化し期待値管理
  - ✅ timeAgo() 関数で「3分前」等の経過時間を募集一覧に表示
- [x] ブロック済みユーザーの募集を非表示にする
  - 現状: マッチ成立時にブロックチェック → 募集一覧でも除外すべき
  - ✅ 実装済み（blocker/blocked双方向フィルタリング）
```

---

## 優先度 P2: 安全性・信頼性の底上げ

### 6. モデレーション強化
**根拠**: GameWithはAI監視、DiscordはAutoMod。人力通報のみでは公開サービスとして不十分。

```
実装タスク:
- [x] NGワードリストの拡充
  - 現状: 日本語6語、英語4語 → 各50語以上に拡充
  - 正規表現パターンも追加（伏字回避対策: 「し◯」「fu*k」等）
  - ✅ 日本語60語以上+英語40語以上+伏字回避パターン11個を実装
- [x] 通報累積によるアカウント自動制限
  - N回通報されたユーザー → 一時的に募集/参加を制限
  - GameWithのペナルティシステムを参考
  - ✅ 3回通報で24h自動停止、suspended_until+is_banned on User、依存性チェック実装
- [x] 管理画面（最低限）
  - 通報一覧の確認・対応
  - ユーザーの一時停止/BAN
  - アクティブルーム/募集のモニタリング
  - ✅ /api/admin/* にレポート管理/ユーザー停止・BAN/統計API実装（秘密鍵認証）
```

### 7. ユーザーフィードバック活用
**根拠**: 全競合が通報はあるが、ポジティブフィードバックの活用は弱い。差別化の余地あり。

```
実装タスク:
- [x] 👍 累積数の可視化（任意表示のマナースコア）
  - 募集一覧で「👍12」のようにマッチ相手の信頼度を示す
  - 厳密なEloではなく「この人は礼儀正しかった」程度の軽い指標
  - ✅ feedbacks テーブルからthumbs_up集計し募集一覧APIで返却、フロント表示実装済み
- [x] フィードバック率の追跡
  - フィードバックを残す習慣をUIで促進（ルームクローズ時に必ずフィードバック画面を経由）
  - ✅ /api/rooms/pending-feedback API + ロビーにフィードバック促進バナー実装
```

---

## 優先度 P3: 成長のための機能

### 8. ゲーム連携の準備
**根拠**: GameWithはURL連携、Xbox LFGはゲーマータグ連携。ゲーム内IDの手動入力は摩擦。

```
実装タスク:
- [ ] ゲームIDフィールドをプロフィールに追加（任意入力）
  - 例: Steam ID, PSN ID, Nintendo Friend Code, Riot ID
  - マッチ成立後のルーム画面で相手に表示
- [ ] Discord連携（OAuth2）の検討
  - 日本のゲーマーの多くがDiscord利用中 → ログインの選択肢として有力
  - Discord Webhook連携でマッチ成立通知も可能
```

### 9. SEO・発見性の改善
**根拠**: GameWithはSEOで圧倒的集客。本サービスの認知獲得にもSEOは重要。

```
実装タスク:
- [ ] 「今募集中のゲーム一覧」を公開ページとして用意
  - ログイン不要で閲覧可能な募集リスト（参加にはログイン必要）
  - 「[ゲーム名] 募集 マッチング」で検索流入を狙う
- [ ] OGP/メタタグの最適化
- [ ] サイトマップ生成
```

---

## 実装順序の推奨

```
Phase 1（即座に着手）:
  P0-1. Bot/スパム対策（CAPTCHA） ← 公開前に必須
  P0-2. WebSocket通知 ← UXの根幹改善

Phase 2（公開後1-2週間）:
  P1-3. ゲームカタログ拡充
  P1-4. PWA対応
  P1-5. マッチ精度改善（プレイスタイル/マイク有無）

Phase 3（公開後1ヶ月）:
  P2-6. モデレーション強化（NGワード拡充、管理画面）
  P2-7. マナースコア表示

Phase 4（成長フェーズ）:
  P3-8. ゲーム連携
  P3-9. SEO対策
```
